apiVersion: v1
kind: ConfigMap
metadata:
  name: fluxgate-edge-config
  namespace: fluxgate
data:
  config.toml: |
    # Edge Server Configuration

    # Backend gRPC server address
    backend_grpc = "http://fluxgate-backend:50051"

    # HTTP server bind address
    http_addr = "0.0.0.0:8081"

    # Client credentials for backend authentication
    # IMPORTANT: Override these in production with actual values
    client_id = "{{CLIENT_ID_UUID}}"
    client_secret = "{{CLIENT_API_KEY}}"

    # gRPC connection settings
    [grpc]
    # Connection timeout in seconds
    connect_timeout_secs = 5
    # Request timeout in seconds
    timeout_secs = 10
    # TCP keepalive interval in seconds
    tcp_keepalive_secs = 30
    # HTTP/2 keepalive interval in seconds
    http2_keepalive_secs = 20
    # Keep connection alive even when idle
    keep_alive_while_idle = true
    # Maximum concurrent requests
    concurrency_limit = 256
    # Enable TCP_NODELAY
    tcp_nodelay = true

    # Flush settings
    [flush]
    # User assignment flush interval in seconds
    assignment_flush_secs = 10
    # Evaluation events flush interval in seconds
    evaluation_flush_secs = 30

    # Retry settings
    [retry]
    # Base delay for exponential backoff in milliseconds
    base_delay_ms = 500
    # Maximum retry attempts for direct gRPC calls
    max_attempts = 3
    # Initial delay for stream reconnection in seconds
    stream_initial_delay_secs = 1
    # Maximum delay for stream reconnection in seconds
    stream_max_delay_secs = 30
