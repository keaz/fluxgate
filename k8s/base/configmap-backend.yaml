apiVersion: v1
kind: ConfigMap
metadata:
  name: fluxgate-backend-config
  namespace: fluxgate
data:
  config.toml: |
    # Feature Toggle Backend configuration

    # CORS allowed origin for the frontend
    allowed_origin = "http://fluxgate.example.com"

    # Address that the Actix-Web HTTP server binds to
    http_addr = "0.0.0.0:8080"

    # Address that the gRPC server binds to
    grpc_addr = "0.0.0.0:50051"

    # JWT secret for token signing and verification
    # IMPORTANT: Override this in production with a secure secret
    jwt_secret = "your_secure_jwt_secret_change_in_production_minimum_32_characters"

    # Cluster replication configuration
    # Each node automatically generates a unique UUID as its node_id for auto-scaling support
    [cluster]
    enabled = true
    listen_addr = "0.0.0.0:6000"
    reconnect_delay_ms = 2000

    # Database-backed peer discovery configuration
    [cluster.discovery]
    heartbeat_interval_secs = 30
    stale_threshold_secs = 90
    cleanup_interval_secs = 60

  log4rs.yaml: |
    refresh_rate: 30 seconds

    appenders:
      stdout:
        kind: console
        encoder:
          pattern: "{d(%Y-%m-%d %H:%M:%S%.3f)} [{l}] [{t}] {m}{n}"

    root:
      level: debug
      appenders:
        - stdout
